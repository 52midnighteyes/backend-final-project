
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum User_Role {
  USER
  TENANT
  ADMIN
}
        

model User {
  id String @id @unique @default(uuid())
  phone_number Int?
  first_name String
  last_name String
  email String @unique
  password String?
  role User_Role @default(USER)
  avatar String?
  isVerified Boolean @default(false)

  login_attempt Int @default(0)
  login_time_out DateTime?
  is_suspended Boolean @default(false)
  suspended_cooldown DateTime?

  is_external_login Boolean? @default(false)
  
  created_at DateTime @default(now())
  deleted_at DateTime? 

  replies Reply[]
  transactions Transaction[] 
  temporary_tokens  Temporary_Token[]
  reservations Reservation[]
  properties Property[]


@@map("Users")
}


model Property {
  id String @id @unique @default(uuid())
  name String
  city_id String
  description String
  category_id String
  user_id String
  deleted_at DateTime?
  slug String @unique

  pictures Property_Picture[]
  room_types Room_Type[]

  transactions Transaction[]
  add_ons Add_On[]

  category Category @relation(fields: [category_id], references: [id])
  city City @relation(fields: [city_id], references: [id])
  user User @relation(fields: [user_id], references: [id])

  @@map("Properties")
}


model Property_Picture{
  id String @id @default(uuid())
  url String @unique
  property_id String

  property Property @relation(fields: [property_id], references: [id])

  @@map("Property_Pictures")
}

model Reservation {
  id String @id @unique @default(uuid())
  user_id String
  transaction_id String @unique
  
  is_checkin Boolean @default(false)
  is_checkout Boolean @default(false)

  created_at DateTime @default(now())

  transaction Transaction @relation(fields: [transaction_id], references: [id])
  user User @relation(fields: [user_id], references: [id])
  review Review?

@@map("Reservations")
}

enum Transaction_Status {
  WAITING_FOR_PAYMENT
  WAITING_FOR_CONFIRMATION
  PAID
  CANCELED
  EXPIRED
}

model Transaction {
  id String @id @unique @default(uuid())
  user_id String
  property_id String
  room_type_id String
  amount Decimal
  special_request String
  payment_proof String?
  status Transaction_Status

  start_date DateTime
  end_date DateTime

  created_at DateTime @default(now())
  expired_at DateTime?

  reservation Reservation?
  property Property @relation(fields: [property_id], references: [id])
  room_type Room_Type @relation(fields: [room_type_id], references: [id])
  user User @relation(fields: [user_id], references: [id])

@@map("Transactions")
}

enum Pricing_type {
  NOMINAL
  PERCENTAGE
}

enum Pricing_priority {
  HIGH
  MEDIUM
  LOW
}

model Pricing {
  id String @id @default(uuid())
  room_type_id String
  value Decimal
  priority_level Pricing_priority
  
  is_rentable Boolean @default(true)

  start_date DateTime
  end_date DateTime

  created_at DateTime

  room_type Room_Type @relation(fields: [room_type_id], references: [id])

@@map("Pricings")
}

model Review {
  id String @id @default(uuid())
  reservation_id String @unique
  rating Int
  notes String
  replies Reply[]

  reservation Reservation @relation(fields: [reservation_id], references: [id])

@@map("Reviews")
}

model Reply {
  id String @id @default(uuid())
  user_id String
  review_id String
  notes String
  
  user User @relation(fields: [user_id], references: [id])
  review Review @relation(fields: [review_id], references: [id])

@@map("Replies")
}


model Bed_Type {
  id String @id @default(uuid())
  name String

  room_types Room_Type[]

  @@map("Bed_Types")
}

model Room_Type {
  id String @id @unique @default(uuid())
  name String
  description String
  capacity Int
  base_price Int
  size Decimal

  total_rooms Int


  bed_type_id String
  property_id String


  room_type_pictures Room_Type_Picture[]
  facilities Room_Type_Facility[]
  pricings Pricing[]
  transactions Transaction[]
  
  
  property Property @relation(fields: [property_id], references: [id])
  bed_type Bed_Type @relation(fields: [bed_type_id], references: [id])
  

    @@map("Room_Types")

}

model Add_On {
  id String @id @default(uuid())
  property_id String
  name String
  description String
  price Decimal

  property Property @relation(fields: [property_id], references: [id])

  @@map("Add_Ons")
}

model Room_Type_Picture {
  id String @id @default(uuid())
  url String
  description String
  room_type_id String

  room_type Room_Type @relation(fields: [room_type_id], references: [id])
}

model Room_Type_Facility {
  room_type_id String
  room_facility_id String

  room_type Room_Type @relation(fields: [room_type_id], references: [id])
  room_facility Room_Facility @relation(fields: [room_facility_id], references: [id])

  @@id([room_type_id, room_facility_id])
}




model Room_Facility {
  id String @id @default(uuid())
  name String
  description String
  room_types Room_Type_Facility[]

    @@map("Room_Facilities")

}

model Category {
  id String @id @unique @default(uuid())
  name String
  description String
  properties Property[]

  @@map("Categories")
}


model Country {
  id String @id @default(uuid())
  name String
  code String @unique
  provinces Province[]

@@map("Countries")
}

model Province {
  id String  @id @default(uuid())
  name String
  country_id String
  country Country @relation(fields: [country_id], references: [id])
  cities City[]

  @@map("Provinces")
}

model City {
  id String @id @default(uuid())
  name String
  province_id String
  properties Property[]
  province Province @relation(fields: [province_id], references: [id])

  @@map("Cities")
}

enum Temporary_Token_Type {
  RESET_PASSWORD
  RESET_EMAIL
  FORGOT_PASSWORD
}

model Temporary_Token {
  id String @id @default(uuid())
  token String @unique
  user_id String
  expired_at DateTime
  type Temporary_Token_Type


  user User @relation(fields: [user_id],references: [id])

  @@map("Temporary_Tokens")
}



